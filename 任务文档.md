# 个人AI OS系统 - 任务文档（Kimi K2工作流版）

## 1. 项目概述

### 1.1 项目目标
构建以Kimi K2 API为核心推理引擎的个人AI操作系统，实现信息提炼、深度分析和广度思考自动化。

### 1.2 项目范围
- 信息处理自动化脚本
- Super Analyst深度分析工作流
- New Angle广度思考工作流
- 工作流调度与配置管理

### 1.3 项目约束
- 所有数据存储在本地文件系统
- 模型调用统一通过Kimi K2官方API（REST）
- 工作流由本地Python脚本编排，无Claude技能依赖

## 2. 任务分解

### 2.1 基础设施与目录结构

#### 任务1.1：项目目录初始化
**优先级**：P0（最高）  
**依赖**：无  
**描述**：搭建符合技术文档定义的目录树。

**子任务**：
- [ ] 创建 `data/raw/`、`data/medium-rare/`、`data/topic/`
- [ ] 创建 `workflows/super_analyst/` 与 `workflows/new_angle/`
- [ ] 创建 `scripts/`、`config/`、`logs/`
- [ ] 初始化 `.gitignore`（可选）

**验收标准**：
- 文件夹结构与技术文档一致
- 目录具有读写权限

**预计工时**：0.5小时

---

#### 任务1.2：配置文件模板
**优先级**：P0  
**依赖**：任务1.1  
**描述**：准备Kimi API与系统配置模板。

**子任务**：
- [ ] 创建 `config/kimi_api.json` 模板（含base_url、model、env变量）
- [ ] 创建 `config/system_config.json`（周起始日、默认框架等）
- [ ] 在README或注释中说明如何填写API Key

**验收标准**：
- 模板字段与技术文档一致
- 配置文件通过JSON校验

**预计工时**：1小时

---

### 2.2 信息处理模块

#### 任务2.1：周文件夹管理脚本
**优先级**：P0  
**依赖**：任务1.1  
**描述**：实现 `scripts/folder_manager.py`。

**子任务**：
- [ ] 提供创建/获取当前周目录的函数
- [ ] 支持列出既往周目录、处理跨年
- [ ] 编写基本单元测试

**验收标准**：
- 调用 `create_week_folder()` 返回有效路径
- 重复调用不会重新创建
- 测试覆盖主要分支

**预计工时**：2小时

---

#### 任务2.2：内容提炼脚本
**优先级**：P0  
**依赖**：任务2.1、任务3.1  
**描述**：实现 `scripts/content_processor.py`，负责批量读取Markdown并调用Kimi K2生成提炼。

**子任务**：
- [ ] 设计调用Kimi K2的提示词与系统信息
- [ ] 支持批量请求（可串行，后续可并行）
- [ ] 输出结构包含 Summary / Key Takeaways / Something New
- [ ] 生成合并文档并写入 `data/medium-rare/`
- [ ] 在CLI中暴露命令入口

**验收标准**：
- 指定周目录后自动生成对应提炼文档
- Markdown结构符合技术文档格式
- 错误记录到日志并不中断整个流程

**预计工时**：4小时

---

#### 任务2.3：Chroma Web Clipper流程验证
**优先级**：P1  
**依赖**：任务2.2  
**描述**：验证剪藏 → raw目录 → 提炼全流程。

**子任务**：
- [ ] 试抓取样例网页
- [ ] 确认保存路径与命名规范
- [ ] 执行提炼脚本，验证输出质量

**验收标准**：
- 整个流程无需手动干预即可完成
- 生成的提炼文档可读性良好

**预计工时**：1小时

---

### 2.3 Super Analyst深度分析工作流

#### 任务3.1：框架元数据与模板整理
**优先级**：P0  
**依赖**：任务1.1  
**描述**：在 `workflows/super_analyst/prompts/` 中准备12个分析框架模板。

**子任务**：
- [ ] 为每个框架创建Markdown模板，包含结构化步骤
- [ ] 编写 `frameworks.json` 或 Python字典描述元数据
- [ ] 保障关键词、problem_types等字段完整

**验收标准**：
- 12个模板内容准确、格式一致
- 元数据文件可被 `framework_selector.py` 读取

**预计工时**：3小时

---

#### 任务3.2：框架选择器实现
**优先级**：P0  
**依赖**：任务3.1  
**描述**：开发 `framework_selector.py`。

**子任务**：
- [ ] 实现关键词匹配、问题类型识别
- [ ] 计算匹配分数（考虑权重）
- [ ] 输出Top-N推荐及理由
- [ ] 提供CLI或函数接口

**验收标准**：
- 单元测试覆盖主流程
- 给定样例问题返回合理框架

**预计工时**：4小时

---

#### 任务3.3：Super Analyst主流程脚本
**优先级**：P0  
**依赖**：任务3.2、任务4.1  
**描述**：实现 `workflows/super_analyst/run.py` 与 `pipeline.yaml`。

**子任务**：
- [ ] 解析pipeline配置，串联选择器→模板→Kimi调用→后处理
- [ ] 支持多框架组合，按顺序或并行执行
- [ ] 将Kimi结果写入报告模板
- [ ] 存储到 `data/topic/`
- [ ] 写日志记录执行时间与框架

**验收标准**：
- CLI命令 `python scripts/cli.py super-analyst --topic xxx` 能生成报告
- 报告包含元数据、执行摘要、框架章节
- 日志写入 `logs/super_analyst.log`

**预计工时**：5小时

---

#### 任务3.4：分析报告模板设计
**优先级**：P1  
**依赖**：任务3.3  
**描述**：定义统一的Markdown报告结构。

**子任务**：
- [ ] 创建模板（YAML Front Matter + Markdown正文）
- [ ] 包含执行摘要、关键发现、建议等
- [ ] 提供示例输出

**验收标准**：
- 模板可被 `run.py` 正确填充
- 渲染后结构清晰

**预计工时**：2小时

---

### 2.4 New Angle广度思考工作流

#### 任务4.1：提示词与流程脚本
**优先级**：P1  
**依赖**：任务3.1（可共享方法）  
**描述**：实现 `workflows/new_angle/run.py`。

**子任务**：
- [ ] 提示词包含四个步骤（盲点、视角、类比、创新）
- [ ] 每步独立调用Kimi或合并调用并标记输出段落
- [ ] 支持从CLI传入上下文

**验收标准**：
- CLI命令 `python scripts/cli.py new-angle --input path/to/file.md`
  输出洞察文件
- 每步输出均有标题与内容

**预计工时**：3小时

---

#### 任务4.2：结果整合与存储
**优先级**：P1  
**依赖**：任务4.1  
**描述**：定义New Angle结果的保存格式与位置。

**子任务**：
- [ ] 选择保存路径（例如 `data/topic/new-angle/`）
- [ ] 设计文件命名规则（含时间戳或主题）
- [ ] 集成到CLI

**验收标准**：
- 输出文件命名一致、可追溯
- CLI运行后自动保存并提示路径

**预计工时**：1小时

---

### 2.5 CLI与调度

#### 任务5.1：统一命令行入口
**优先级**：P0  
**依赖**：任务2.2、3.3、4.1  
**描述**：在 `scripts/cli.py` 中整合各功能。

**子任务**：
- [ ] 使用 `typer` 或 `click` 创建命令
- [ ] 支持命令：`ingest`（提炼）、`super-analyst`、`new-angle`
- [ ] 支持全局参数（周目录、输出目录、dry-run等）
- [ ] 添加帮助信息

**验收标准**：
- `python scripts/cli.py --help` 显示完整文档
- 三个核心功能命令可用

**预计工时**：3小时

---

#### 任务5.2：自动化调度（可选）
**优先级**：P2  
**依赖**：任务5.1  
**描述**：提供定时执行方案（如 cron、launchd）。

**子任务**：
- [ ] 编写示例cron配置或launchd plist
- [ ] 文档说明如何启用

**验收标准**：
- 文档能够指导用户配置自动化

**预计工时**：1小时

---

### 2.6 测试与质量保障

#### 任务6.1：单元测试覆盖
**优先级**：P0  
**依赖**：相关模块完成  
**描述**：为关键模块编写pytest用例。

**子任务**：
- [ ] folder_manager / content_processor / framework_selector 测试
- [ ] 模拟Kimi API响应（使用`responses`或`pytest-httpx`）
- [ ] 配置CI（可选）

**验收标准**：
- `pytest` 通过
- 覆盖率满足主要逻辑

**预计工时**：3小时

---

#### 任务6.2：端到端测试
**优先级**：P0  
**依赖**：所有核心模块  
**描述**：验证三个核心流程的整体验收。

**子任务**：
- [ ] 信息提炼全流程测试
- [ ] Super Analyst工作流测试（含多框架）
- [ ] New Angle工作流测试
- [ ] 异常场景：API失败、文件缺失

**验收标准**：
- 三个流程成功执行并生成产出
- 异常情况被捕获并记录

**预计工时**：4小时

---

#### 任务6.3：文档编写
**优先级**：P1  
**依赖**：主要功能完成  
**描述**：完善README、快速开始和故障排查。

**子任务**：
- [ ] 更新项目概述与目录结构
- [ ] 撰写API配置与环境变量说明
- [ ] 添加样例命令和输出

**验收标准**：
- 文档内容与实现一致
- 用户可按文档完成部署与使用

**预计工时**：3小时

---

## 3. 优先级划分

| 优先级 | 任务 | 说明 |
|--------|------|------|
| P0 | 1.1, 1.2, 2.1, 2.2, 3.1, 3.2, 3.3, 5.1, 6.1, 6.2 | 核心架构、主要流程与测试 |
| P1 | 2.3, 3.4, 4.1, 4.2, 6.3 | 提升体验与输出质量 |
| P2 | 5.2 | 可选自动化 |

## 4. 里程碑规划

### 里程碑1：基础设施与信息提炼（Week 1）
- 完成任务1.1、1.2、2.1、2.2
- 验收：可自动为一周内容生成提炼文档

### 里程碑2：Super Analyst工作流（Week 2）
- 完成任务3.1、3.2、3.3、6.1部分
- 验收：指定问题可生成结构化分析报告

### 里程碑3：广度思考与CLI整合（Week 3）
- 完成任务4.1、4.2、5.1、6.2
- 验收：命令行驱动所有流程，输出完整结果

### 里程碑4：文档与优化（Week 3-4）
- 完成任务3.4、2.3、6.3、5.2（可选）
- 验收：项目文档齐全，用户可独立部署

## 5. 风险与应对

| 风险 | 影响 | 概率 | 对策 |
|------|------|------|------|
| Kimi API限流/异常 | 高 | 中 | 实现重试与速率控制，准备Mock服务 |
| 框架模板质量不佳 | 中 | 中 | 建立迭代机制，收集输出样例持续优化 |
| 文本长度超限 | 中 | 中 | 在调用前统计token，必要时拆分请求 |
| 批量处理耗时 | 中 | 中 | 支持并行/缓存，提供进度提示 |

## 6. 验收清单

- [ ] CLI提供`ingest`、`super-analyst`、`new-angle`三大功能
- [ ] 所有输出存放在约定路径且结构化
- [ ] 日志文件记录关键步骤与异常
- [ ] 单元测试与端到端测试通过
- [ ] README提供完整部署说明
